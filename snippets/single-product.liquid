{%- assign on_sale = false -%}
{%- if product.compare_at_price > product.price -%}
{%- assign on_sale = true -%}
{%- endif -%} 
{%- assign sold_out = true -%} 
{%- if product.available -%}
{%- assign sold_out = false -%}
{%- endif -%}
{%- assign variant = product.selected_or_first_available_variant -%}
{%- if product.available -%}
{%- assign func = "Shopify.addItem(" | append: variant.id | append: ", 1)" -%}
{%- endif -%}
<div class="single-wrap">
  <div class="{% if product.available %}product-image{% else %}product-image stock-out{% endif %}">
    <a class="pro-img" href="{{ product.url | within: collection }}">
      <img class="img-fluid img1" src="{% if product.featured_image.src %}{{ product.featured_image.src | img_url : '500X500', crop: 'center' }}{% else %}https://dummyimage.com/500x500/f7f7f7/999999{% endif %}" alt="{{ product.featured_image.src.alt | escape  }}">
    </a>
  </div>
  <div class="product-txt">
    <form action="/cart/add" method="post" class="cart" enctype="multipart/form-data" id="add-item-form-{{product.id}}">
      <div class="product-content">
        <div class="product-title">
          <h6>{{ product.title | truncate: 30 }}</h6>
        </div>
        <div class="price-box" id="ProductPrice-{{product.id}}">
          <span class="new-price">{{ product.selected_or_first_available_variant.price.price | money }}</span>
          {% if product.compare_at_price_max > product.price %}
          <span class="old-price">{{ product.compare_at_price | money }}</span>
          {% endif %}
        </div>
        {%- unless section.settings.product_variant_handle == 'product_variant_without_option' -%}
        {% include 'product-swatch-variant' %}
        {%- endunless -%}
        {% if product.available %}
        <div class="product-action">
          {% if product.available %}
          <a href="javascript:void(0);" class="add-to-cart ajax-spin-cart btn btn-style2-medium" id="cart-{{product.id}}">
            <span class="cart-title">
              {{ settings.cart_button_title }}
            </span>
            <span class="cart-loading animated infinite rotate">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>
            </span>
            <span class="cart-added">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </span>
            <span class="cart-unavailable"><i class="ion-android-alert"></i></span>
          </a>
          {% else %}
          <a class="disabled-add-to-cart add-to-cart disabled" disabled="disabled" href="#" title="Out of stock"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-cart"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg></a>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </form>
  </div>
</div>
<script>
  function instantBuy(){
    var $ = jQuery;
    var formParams = $('form.cart').serialize();
    $.ajax({
      url: "/cart/add",
      type: "post",
      data: formParams,
      success: function(){
        window.location.href = "/checkout";
      },
      error: function(){
      }
    })
  }
  var selectCallback = function(variant, selector) {
    timber.productPage({
      money_format: "{{ shop.money_format }}",
      variant: variant,
      selector: selector
    });
    if (variant.available) {
// Current variant select+
var form = jQuery('#' + selector.domIdPrefix).closest('form');
for (var i=0,size=variant.options.size; i<size; i++) {
  var val = variant.options[i].replace(/'/g,"&#039;");
  var radioButton = form.find(".swatch[data-option-index='" + i + "'] :radio[value='" + val +"']");
  if (radioButton.size()) {
    radioButton.get(0).checked = true;
  }
}
// Current sku pass
$('.variant-sku').text(variant.sku);
}
else {
  $('.variant-sku').empty();
}
if (variant {% comment %}&& variant.available{% endcomment %}) {
  if(variant.price < variant.compare_at_price) {
    $('#ProductPrice-'+variant.featured_image.product_id).html('<span class="new-price">'+Shopify.formatMoney(variant.price, "{{ shop.money_format }}")+'</span><span class="old-price">'+Shopify.formatMoney(variant.compare_at_price,  "{{ shop.money_format }}")+'</span>');
  } else {
    $('#ProductPrice-'+variant.featured_image.product_id).html('<span class="new-price">'+Shopify.formatMoney(variant.price, "{{ shop.money_format }}")+'</span>');
  }
}
if (variant && variant.featured_image) {
  jQuery('#pro-detail-slider a[data-image-id="' + variant.featured_image.id + '"]').trigger('click');
}
};
jQuery(function($) {
  new Shopify.OptionSelectors('productSelect-{{ product.id }}', {
    product: {{ product | json }},
    onVariantSelected: selectCallback,
    enableHistoryState: false
  });
// Add label if only one product option and it isn't 'Title'. Could be 'Size'.
{% if product.options.size == 1 and product.options.first != 'Title' %}
var product_select = 'productSelect-{{ product.id }}-option-0';
$('#'+product_select).before('<label for="'+product_select+'">{{ product.options.first | escape }}</label>');
{% endif %}
// Hide selectors if we only have 1 variant and its title contains 'Default'.
{% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
$('.selector-wrapper').hide();
{% endif %}
});
jQuery('#cart-{{product.id}}').click(function(e) {
  var formParams = $(this).parent().parent().parent('form.cart').attr('id');
  var formParams2 = $(this).parent().parent().parent('form.cart').serialize();
  e.preventDefault();
  Shopify.addItemFromForm(formParams);
});
</script>
<style>
  a.add-to-cart.disabled{
    color: #eaeaea;
    background-color: #ababab;
    opacity: .65;
    pointer-events: none;
  }
</style>